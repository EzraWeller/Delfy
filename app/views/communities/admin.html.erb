<div class="community-admin-page">
	<% flash.each do |message_type, message| %>
		<div class="alert alert-<%= message_type %>"><%= message %></div>
	<% end %>

	<p><%= link_to "Back", community_path(@community) %></p>

	<div>
		<h1><%= @community.name %> Admin Options</h1>
	</div>

	<div>
		<p><strong>Name:</strong> <%= @community.name %></p>
		<p><strong>Description:</strong> <%= @community.description %></p>
		<p><strong>Membership setting:</strong> <%= @community.membership_setting %></p>

		<h3>Edit settings</h3>
		<%= form_for @community do |f| %>
			<%= f.label :name %>
		    <%= f.text_field :name %>

		    <%= f.label :description %>
		    <%= f.text_area :description %>

		    <%= f.label :membership_setting do %>
		    	<div>Membership Setting</div>
			    <%= f.radio_button :membership_setting, 'open' %>
			    <%= f.label :membership_setting, 
			    	"Open (Anyone can join.)", value: 'open' %></br>
			    <%= f.radio_button :membership_setting, 'closed' %>
			    <%= f.label :membership_setting, 
			    	"Closed (Only users you invite or who have an access key can join.)", value: "restricted" %>
			<% end %>

		    <%= f.submit "Save new community settings", data: {confirm: "Are you sure?"} %>
		<% end %>

		<% if @community.membership_setting == "closed" %>
			<p>
				<h3>Invite people to the community:</h3>

				<%= form_for community_invites_path(@community), html: { class: "new_invitations", remote: true } do |f| %>
					<%= f.hidden_field :community_id, value: @community.id, name: "invitations[community_id]" %>

					<%= f.label :emails, "Up to 200 email addresses, separated by commas:", name: "invitations[emails]" %>
					<%= f.text_area :emails, name: "invitations[emails]" %>

					<%= f.submit "Invite" %>
				<% end %>
			</p>
			<p>
				<h3>Past invitations:</h3>
				<div class="columns">
					<div>
						Total invitations:</br>
						Total emails invited:
					</div>
					<div>
						<%= @community.invitations.count %></br>
						<%= @community.invitations.pluck(:email).uniq.count %>
					</div>
				</div>
				</br>
				<div class="columns">
					<div>
						<strong>Email</strong></br>
						<% @invitations.each do |i| %>
							<%= i.email %>
							</br>
						<% end %>
					</div>
					<div>
						<strong>Time sent</strong></br>
						<% @invitations.each do |i| %>
							<%= i.created_at %>
							</br>
						<% end %>
					</div>
					<div>
						<strong>Status</strong></br>
						<% @invitations.each do |i| %>
							<% if i.accepted? %>
								<span style="color:#1A9407;">Accepted</span>
							<% else %>
								<span style="color:orange;">Pending</span>
							<% end %>
							</br>
						<% end %>
					</div>
				</div>
				</br>
				<%= paginate @invitations %>
			</p>
		<% end %>
	</div>
</div>